{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Feed</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static '/css/newsfeed_home.css' %}">
    <style>
        .btn-primary:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <span>News Feed</span>
            </div>
            <div class="nav-links">
                <a href="{% url 'home' %}" class="nav-item {% if active_tab == 'home' %}active{% endif %}">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="{% url 'resource_home' %}" class="nav-item {% if active_tab == 'resource' %}active{% endif %}">
                    <i class="fas fa-archive"></i>
                    <span>Resources</span>
                </a>
                <a href="#" class="nav-item {% if active_tab == 'messages' %}active{% endif %}">
                    <i class="fas fa-envelope"></i>
                    <span>Messages</span>
                    <span class="badge">3</span>
                </a>
                <a href="{% url 'task_list' %}" class="nav-item {% if active_tab == 'tasks' %}active{% endif %}">
                    <i class="fas fa-tasks"></i>
                    <span>Tasks</span>
                </a>
                <a href="{% url 'reward-list' %}" class="nav-item {% if active_tab == 'rewards' %}active{% endif %}">
                    <i class="fas fa-trophy"></i>
                    <span>Rewards</span>
                </a>
                <a href="{% url 'leaderboard' %}" class="nav-item {% if active_tab == 'leaderboard' %}active{% endif %}">
                    <i class="fas fa-medal"></i>
                    <span>Leaderboard</span>
                </a>
                <a href="{% url 'feedback-list' %}" class="nav-item {% if active_tab == 'feedback' %}active{% endif %}">
                    <i class="fas fa-comment-dots"></i>
                    <span>Feedback</span>
                </a>
                <div class="profile-dropdown">
                    <button class="profile-btn nav-item">
                        <i class="fas fa-user-circle fa-lg"></i>
                        <span>{{ user.username }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu">
                        <a href="{% url 'profile' %}" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                        <hr class="dropdown-divider">
                        <button class="dropdown-item text-danger" onclick="showLogoutModal()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="content-wrapper">
            <aside class="sidebar">
                <div class="create-post-card">
                    <h2><i class="fas fa-pen"></i> Create Post</h2>
                    <form method="POST" action="{% url 'create_post' %}" class="create-post-form" id="createPostForm">
                        {% csrf_token %}
                        <div class="form-group">
                            {{ form.as_p }}
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <i class="fas fa-paper-plane"></i> Share Post
                            </button>
                        </div>
                    </form>
                </div>
            </aside>

            <section class="feed">
                <div class="feed-header">
                    <h1>Your Feed</h1>
                    <div class="feed-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="latest">Latest</button>
                        <button class="filter-btn" data-filter="popular">Popular</button>
                    </div>
                </div>

                <div class="posts-grid">
                    {% for post in newsfeeds %}
                    <article class="post-card" data-post-id="{{ post.feed_id }}">
                        <div class="post-header">
                            <div class="user-info">
                                <div class="avatar">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="user-meta">
                                    <h3>{{ post.created_by }}</h3>
                                    <span class="post-date">{{ post.post_date|date:"F j, Y" }}</span>
                                </div>
                            </div>
                            <div class="post-badge">{{ post.post_type }}</div>
                        </div>
                        
                        <div class="post-content">
                            <p>{{ post.post_description }}</p>
                        </div>

                        <div class="post-actions">
                            <form action="{% url 'like_post' post.feed_id %}" method="POST" class="action-form">
                                {% csrf_token %}
                                <button type="submit" class="action-btn like-btn {% if post.user_has_liked %}liked{% endif %}">
                                    <i class="fas fa-heart"></i>
                                    <span>{{ post.like_count }}</span>
                                </button>
                            </form>
                            
                            <div class="post-controls">
                                <form action="{% url 'update_post' post.feed_id %}" method="GET" style="display: inline;">
                                    <button type="submit" class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i>
                                        <span>Edit</span>
                                    </button>
                                </form>
                                
                                <button class="action-btn delete-btn" onclick="showDeleteConfirm('{{ post.feed_id }}')">
                                    <i class="fas fa-trash"></i>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </div>
                    </article>
                    {% empty %}
                    <div class="empty-state">
                        <i class="fas fa-newspaper"></i>
                        <h3>No posts yet</h3>
                        <p>Be the first to share something with your network!</p>
                    </div>
                    {% endfor %}
                </div>
            </section>
        </div>
    </main>

    <!-- Logout Modal -->
    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <h3>Confirm Logout</h3>
            <p>Are you sure you want to logout?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideLogoutModal()">Cancel</button>
                <form method="post" action="{% url 'logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Logout</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>Delete Post</h3>
            <p>Are you sure you want to delete this post?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideDeleteModal()">Cancel</button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Form validation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('createPostForm');
            const submitButton = document.getElementById('submitButton');
            const formInputs = form.querySelectorAll('input[type="text"], textarea, select');

            function validateForm() {
                let isValid = true;
                formInputs.forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                    }
                });
                submitButton.disabled = !isValid;
            }

            formInputs.forEach(input => {
                input.addEventListener('input', validateForm);
                input.addEventListener('change', validateForm);
            });

            validateForm();
        });

        // Profile dropdown
        const profileBtn = document.querySelector('.profile-btn');
        const dropdownMenu = document.querySelector('.dropdown-menu');

        profileBtn.addEventListener('click', () => {
            dropdownMenu.classList.toggle('show');
        });

        window.addEventListener('click', (e) => {
            if (!e.target.closest('.profile-dropdown')) {
                dropdownMenu.classList.remove('show');
            }
        });

        // Modals
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function hideLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function showDeleteConfirm(postId) {
            document.getElementById('deleteModal').style.display = 'block';
            document.getElementById('deleteForm').action = `/delete_post/${postId}/`;
        }

        function hideDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            const logoutModal = document.getElementById('logoutModal');
            const deleteModal = document.getElementById('deleteModal');
            
            if (e.target === logoutModal) {
                hideLogoutModal();
            }
            if (e.target === deleteModal) {
                hideDeleteModal();
            }
        });

        // Post filters
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                // Add filter logic here
            });
        });
    </script>
</body>
</html>