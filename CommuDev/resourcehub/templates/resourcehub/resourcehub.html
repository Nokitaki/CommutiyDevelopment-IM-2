<!--resourcehub/templates/resourcehub/home.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CommuDev ResourceHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">   
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .feed-container {
            height: calc(100vh - 64px);
            margin-top: 64px;
        }

        .sidebar {
            width: 400px;
            height: calc(100vh - 64px);
            overflow-y: auto;
        }

        .special-date {
            background-color: #e2f0ff !important;
            border-radius: 50%;
        }

        .event-dot {
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: #FF0400;
            border-radius: 50%;
        }
  
        .flatpickr-day {
            position: relative;
        }

        .main-content {
            width: calc(100% - 800px);
            max-width: 800px;
            margin: 0 auto;
        }

        .heart-button {
            transition: transform 0.2s ease;
        }

        .heart-button:hover {
            transform: scale(1.1);
        }

        .heart-button.liked {
            color: #ef4444;
        }

        .category-pill {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .category-pill:hover {
            background-color: #e5e7eb;
        }

        .resource-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .special-date {
          background-color: #e2f0ff !important;
          border-radius: 50%;
        }

        .event-dot {
          position: absolute;
          bottom: 3px;
          left: 50%;
          transform: translateX(-50%);
          width: 4px;
          height: 4px;
          background-color: #FF0400;
          border-radius: 50%;
        }
  
        .flatpickr-day {
          position: relative;
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            padding: 1rem;
        }

        .resource-card {
            background: white;
            border-radius: 0.75rem;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .resource-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .resource-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .resource-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .resource-preview {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .modal-scroll {
            max-height: 80vh;
            overflow-y: auto;
        }

        .image-preview {
            max-width: 100%;
            height: 200px;
            border-radius: 0.5rem;
            object-fit: cover;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-white shadow-md fixed top-0 w-full z-50 h-16">
        <div class="w-full px-4 flex justify-between items-center h-full">
            <div class="flex-shrink-0">
                <h1 class="text-2xl font-bold text-gray-900">CommuDev</h1>
            </div>
            <div class="flex items-center space-x-8">
                <a href="{% url 'home' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs mt-1">Home</span>
                </a>
                <a href="{% url 'resource_home' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center">
                    <i class="fas fa-book text-xl"></i>
                    <span class="text-xs mt-1">Resources</span>
                </a>
                <a href="{% url 'chat_home' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center relative">
                    <i class="fas fa-comments text-xl"></i>
                    <span class="text-xs mt-1">Chat</span>
                    <span id="nav-unread-count" 
                          class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 rounded-full text-white text-xs flex items-center justify-center hidden">
                    </span>
                </a>
                <a href="{% url 'task:task_list' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center">
                    <i class="fas fa-tasks text-xl"></i>
                    <span class="text-xs mt-1">Tasks</span>
                </a>
                <a href="{% url 'reward-list' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center">
                    <i class="fas fa-gift text-xl"></i>
                    <span class="text-xs mt-1">Rewards</span>
                </a>
                <a href="{% url 'feedback:feedback-list' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center">
                    <i class="fas fa-flag text-xl"></i>
                    <span class="text-xs mt-1">Feedbacks</span>
                </a>
                <a href="{% url 'profile' %}" class="text-gray-600 hover:text-gray-900 flex flex-col items-center">
                    <i class="fas fa-user-circle text-xl"></i>
                    <span class="text-xs mt-1">Profile</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="feed-container flex">
        <!-- Left Sidebar -->
        <div class="sidebar bg-gray-100 p-4 custom-scrollbar">
            <!-- Communities -->
            <div class="bg-white rounded-lg shadow p-4 mb-4">
                <h2 class="font-bold text-xl mb-4">Communities</h2>
                <ul class="space-y-3">
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition duration-150">
                            <i class="fas fa-building text-blue-500"></i>
                            <span class="text-gray-700">Municipal Community</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition duration-150">
                            <i class="fas fa-home text-green-500"></i>
                            <span class="text-gray-700">Barangay Community</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Friends -->
            <div class="bg-white rounded-lg shadow p-4">
                <h2 class="font-bold text-xl mb-4">Friends</h2>
                <ul class="space-y-4">
                    <li class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-gray-500"></i>
                        </div>
                        <span class="text-gray-700">Friend 1</span>
                    </li>
                    <li class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-gray-500"></i>
                        </div>
                        <span class="text-gray-700">Friend 2</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content bg-gray-100 custom-scrollbar overflow-y-auto">
            <div class="space-y-4 p-4">
                <!-- Create Resource Button -->
                <div class="p-4">
                    <button onclick="openCreateResourceModal()" 
                            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg 
                                flex items-center justify-center space-x-2 transition duration-200">
                        <i class="fas fa-plus-circle"></i>
                        <span>Share New Resource</span>
                    </button>
                </div>

                <!-- Categories Section -->
                <div class="px-4 mb-4">
                    <div class="bg-white rounded-lg shadow p-4">
                        <h3 class="font-semibold text-lg mb-3">Categories</h3>
                        {% csrf_token %}
                        <div class="flex flex-wrap gap-2">
                            <a href="{% url 'resource_home' %}" 
                            class="category-pill px-4 py-2 rounded-full {% if not selected_category %}bg-blue-500 text-white{% else %}bg-gray-100 text-gray-700{% endif %}">
                                All
                            </a>
                            {% for category in categories %}
                            <a href="{% url 'resource_home' %}?category={{ category.id }}" 
                            class="category-pill px-4 py-2 rounded-full {% if selected_category == category.id|stringformat:'s' %}bg-blue-500 text-white{% else %}bg-gray-100 text-gray-700{% endif %}">
                                {{ category.name }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- Resource card in list view -->
                <div class="resource-grid">
                    {% for resource in resources %}
                    <div class="resource-card shadow cursor-pointer" 
                    data-category="{{ resource.category.id }}" 
                    onclick="openResourceModal('{{ resource.resource_id }}')">
                        {% if resource.image %}
                        <img src="{{ resource.image.url }}" alt="{{ resource.resource_title }}" class="resource-image">
                        {% else %}
                        <div class="bg-gray-200 h-48 flex items-center justify-center">
                            <i class="fas fa-book text-4xl text-gray-400"></i>
                        </div>
                        {% endif %}
                        
                        <div class="resource-content">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                                    <span class="text-gray-600 font-bold text-sm">{{ resource.created_by.firstname|first }}</span>
                                </div>
                                <div class="text-sm text-gray-500">
                                    {{ resource.created_by.firstname }} {{ resource.created_by.lastname }}
                                </div>
                            </div>
            
                            <h3 class="font-bold text-lg text-gray-900 mb-2">{{ resource.resource_title }}</h3>
                            <p class="text-gray-600 resource-preview mb-4">{{ resource.resource_description|truncatewords:30|striptags}}</p>
                            
                            <div class="mt-auto flex items-center justify-between">
                                <div class="text-sm text-gray-500">
                                    {{ resource.upload_date|date:"F j, Y" }}
                                </div>
                                <div class="flex items-center gap-2">
                                    <button onclick="downloadResource('{{ resource.resource_id }}', event)" class="text-blue-500 hover:text-blue-700">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <span class="text-gray-600 download-count-{{ resource.resource_id }}">{{ resource.download_count }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-span-2 text-center py-8 bg-white rounded-lg shadow">
                        <p class="text-gray-500">No resources shared yet. Be the first to share something!</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="sidebar bg-gray-100 p-4 custom-scrollbar">
            <!-- Calendar -->
            <div class="bg-white rounded-lg shadow p-4 mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold text-xl">Calendar</h2>
                    <button onclick="openCreateEventModal()" class="text-blue-500 hover:text-blue-700">
                        <i class="fas fa-plus-circle text-xl"></i>
                    </button>
                </div>
                <div class="flex justify-center bg-gray-50 rounded-lg">
                    <input type="text" id="calendar" class="hidden">
                </div>
            </div>

            <!-- Notifications -->
            <div class="bg-white rounded-lg shadow p-4">
                <h2 class="font-bold text-xl mb-4">Notifications</h2>
                <div class="space-y-4">
                    <div class="p-3 hover:bg-gray-50 rounded-lg transition duration-150">
                        <p class="text-gray-800">New resource shared</p>
                        <p class="text-sm text-gray-500 mt-1">2 hours ago</p>
                    </div>
                    <div class="p-3 hover:bg-gray-50 rounded-lg transition duration-150">
                        <p class="text-gray-800">Resource liked</p>
                        <p class="text-sm text-gray-500 mt-1">5 hours ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Create Resource Modal -->
        <div id="createResourceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="overflow-y-auto max-h-[90vh] bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 ease-in-out hover:shadow-3xl">
                <div class="p-5 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-900 flex items-center">
                        <i class="fas fa-upload mr-3 text-blue-600"></i>
                        Share New Resource</h3>
                        <button onclick="closeCreateResourceModal()" class="text-gray-500 hover:text-gray-700 transition duration-200 ease-in-out transform hover:rotate-90">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <form method="POST" action="{% url 'create_resource' %}" enctype="multipart/form-data" class="p-6 space-y-5">
                        {% csrf_token %}
                        <div class="space-y-2">
                            <label for="id_resource_title" class="block text-sm font-medium text-gray-700">Resource Title</label>
                            {{ form.resource_title }}
                        </div>
                        <div class="space-y-2">
                            <label for="id_resource_description" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="id_resource_description" name="resource_description" class="tinymce"></textarea>
                        </div>
                        <div class="space-y-2">
                            <label for="id_category" class="block text-sm font-medium text-gray-700">Category</label>
                            {{ form.category }}
                        </div>
                        <div class="space-y-2">
                            <label for="id_image" class="block text-sm font-medium text-gray-700">Image (Optional)</label>
                            {{ form.image }}
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition duration-200" onclick="closeCreateResourceModal()">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition duration-200 flex items-center">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Share Resource
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        <div id="viewResourceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
                <!-- Modal Header -->
                <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 id="modalResourceTitle" class="text-xl font-semibold text-gray-900"></h3>
                    <button onclick="closeResourceModal()" class="text-gray-400 hover:text-gray-500">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
        
                <!-- Modal Content -->
                <div class="flex-1 overflow-y-auto">
                    <!-- Image Section -->
                    <div id="modalResourceImage" class="w-full h-72 bg-gray-100"></div>
        
                    <!-- Content Section -->
                    <div class="p-6">
                        <!-- Author Info -->
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                                <span id="modalAuthorInitial" class="text-gray-900 font-bold"></span>
                            </div>
                            <div>
                                <div id="modalAuthorName" class="font-semibold text-gray-900"></div>
                                <div id="modalDate" class="text-sm text-gray-600"></div>
                            </div>
                        </div>
        
                        <!-- Resource Category -->
                        <div class="mb-4">
                            <span id="modalResourceCategory" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm"></span>
                        </div>
        
                        <!-- Description - Updated with better contrast -->
                        <div class="prose max-w-none mb-6">
                            <div id="modalResourceContent" class="text-gray-900 leading-relaxed whitespace-pre-wrap text-base"></div>
                        </div>
        
                        <!-- Interaction Footer -->
                        <div class="flex items-center justify-between mt-6 pt-4 border-t border-gray-100">
                            <div id="modalHeartCount" class="text-gray-900 font-medium"></div>
                            <div class="flex gap-4">
                                <button onclick="downloadResource(currentResourceId, event)" 
                                        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>
                                    Download Resource
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Edit Resource Modal -->
    <div id="editResourceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg w-full max-w-2xl mx-4">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-900">Edit Resource</h3>
                <button onclick="closeEditResourceModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Resource Title</label>
                        <input type="text" id="editResourceTitle" 
                               class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="editResourceDescription" rows="4" 
                                  class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t flex justify-end space-x-3">
                <button onclick="closeEditResourceModal()" 
                        class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button onclick="saveResourceEdit()" 
                        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Resource Modal -->
    <div id="deleteResourceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg w-full max-w-md mx-4">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-900">Delete Resource</h3>
                <button onclick="closeDeleteResourceModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <p class="text-gray-600">Are you sure you want to delete this resource? This action cannot be undone.</p>
            </div>
            <div class="p-4 border-t flex justify-end space-x-3">
                <button onclick="closeDeleteResourceModal()" 
                        class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button onclick="confirmResourceDelete()" 
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Delete</button>
            </div>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div id="createEventModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg w-full max-w-md mx-4">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-900">Create Event</h3>
                <button onclick="closeCreateEventModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createEventForm" class="p-4">
                {% csrf_token %}
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Event Title</label>
                        <input type="text" id="eventTitle" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Start Date</label>
                        <input type="date" id="eventDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">End Date</label>
                        <input type="date" id="eventEndDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Start Time</label>
                        <input type="time" id="eventTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">End Time</label>
                        <input type="time" id="eventEndTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="eventDescription" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm ring-2 ring-green-500 p-2"></textarea>

                    </div>
                </div>
                <div class="mt-5 flex justify-end space-x-3">
                    <button type="button" onclick="closeCreateEventModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Create Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Events Modal -->
    <div id="viewEventsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg w-full max-w-md mx-4">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-900">Events for <span id="selectedDate"></span></h3>
                <button onclick="closeViewEventsModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div id="eventsList" class="space-y-3">
                    <!-- Events will be dynamically inserted here -->
                </div>
            </div>
            <div class="p-4 border-t flex justify-end">
                <button onclick="closeViewEventsModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.3/tinymce.min.js"></script>
    <script>
        let currentResourceId = null;

        // Modal Functions
        function openCreateResourceModal() {
            document.getElementById('createResourceModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeCreateResourceModal() {
            document.getElementById('createResourceModal').classList.add('hidden');
            document.body.style.overflow = '';
            document.querySelector('form').reset();
        }

        function editResource(resourceId) {
            currentResourceId = resourceId;
            const titleElement = document.querySelector(`[data-resource-id="${resourceId}"] .resource-title`);
            const descriptionElement = document.querySelector(`[data-resource-id="${resourceId}"] .resource-description`);
            
            document.getElementById('editResourceTitle').value = titleElement.textContent.trim();
            document.getElementById('editResourceDescription').value = descriptionElement.textContent.trim();
            document.getElementById('editResourceModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeEditResourceModal() {
            document.getElementById('editResourceModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function deleteResource(resourceId) {
            currentResourceId = resourceId;
            document.getElementById('deleteResourceModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeDeleteResourceModal() {
            document.getElementById('deleteResourceModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Resource Actions
        function saveResourceEdit() {
            const title = document.getElementById('editResourceTitle').value;
            const description = document.getElementById('editResourceDescription').value;
            
            fetch(`/resource/update/${currentResourceId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
                body: JSON.stringify({
                    resource_title: title,
                    resource_description: description
                })
            }).then(response => {
                if (response.ok) {
                    window.location.reload();
                }
            });
        }

        function confirmResourceDelete() {
            fetch(`/resource/delete/${currentResourceId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                }
            }).then(response => {
                if (response.ok) {
                    window.location.reload();
                }
            });
        }

        function likeResource(resourceId) {
            fetch(`/resource/like/${resourceId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                }
            })
            .then(response => response.json())
            .then(data => {
                const heartButton = document.querySelector(`[data-resource-id="${resourceId}"] .heart-button`);
                const heartCount = document.querySelector(`[data-resource-id="${resourceId}"] .heart-count`);
                
                if (data.liked) {
                    heartButton.classList.add('text-red-500');
                } else {
                    heartButton.classList.remove('text-red-500');
                }
                heartCount.textContent = data.heart_count;
            });
        }

        // Category Filtering
        document.querySelectorAll('.category-pill').forEach(pill => {
            pill.addEventListener('click', function() {
                // Remove active class from all pills
                document.querySelectorAll('.category-pill').forEach(p => {
                    p.classList.remove('bg-blue-500', 'text-white');
                    p.classList.add('bg-gray-100', 'text-gray-700');
                });
                
                // Add active class to clicked pill
                this.classList.remove('bg-gray-100', 'text-gray-700');
                this.classList.add('bg-blue-500', 'text-white');
                
                // Here you would add logic to filter resources by category
            });
        });

        // Initialize calendar (same as in your newsfeed template)
        const calendar = flatpickr("#calendar", {
            inline: true,
            dateFormat: "Y-m-d",
            defaultDate: "today",
            onChange: function(selectedDates, dateStr, instance) {
                showEventsForDate(dateStr);
            }
        });
    </script>

    <script>
        // Calendar Events JavaScript
        let events = [];

        function initializeCalendar() {
            if (calendar) {
                calendar.destroy();
            }
            flatpickr("#calendar", {
                inline: true,
                dateFormat: "Y-m-d",
                defaultDate: "today",
                disableMobile: true,
                onChange: function(selectedDates, dateStr, instance) {
                    showEventsForDate(dateStr);
                },
                onMonthChange: function(selectedDates, dateStr, instance) {
                    updateCalendarDots();
                },
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const dateStr = flatpickr.formatDate(dayElem.dateObj, "Y-m-d");
                    if (hasEventsOnDate(dateStr)) {
                        dayElem.innerHTML += '<span class="event-dot"></span>';
                    }
                }
            });
            updateCalendarDots();
        }

        // Load events when page loads
        function loadEvents() {
            console.log('Loading events...');
            fetch('/calendar/get/')
                .then(response => {
                    console.log('Response received:', response);
                    return response.json();
                })
                .then(data => {
                    console.log('Events data:', data);
                    events = data.events || [];
                    updateCalendarDots();
                })
                .catch(error => console.error('Error loading events:', error));
        }

        document.addEventListener('DOMContentLoaded', loadEvents);

        function openCreateEventModal() {
            document.getElementById('createEventModal').classList.remove('hidden');
            document.getElementById('eventDate').value = flatpickr.formatDate(new Date(), "Y-m-d");
        }

        function closeCreateEventModal() {
            document.getElementById('createEventModal').classList.add('hidden');
            document.getElementById('createEventForm').reset();
        }

        function closeViewEventsModal() {
            document.getElementById('viewEventsModal').classList.add('hidden');
        }

        // Create event form submission
        document.getElementById('createEventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const eventData = {
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                date: document.getElementById('eventDate').value,
                end_date: document.getElementById('eventEndDate').value,
                time: document.getElementById('eventTime').value || '00:00',
                end_time: document.getElementById('eventEndTime').value || '23:59'
            };

            console.log('Sending event data:', eventData);

            fetch('/calendar/create/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
                body: JSON.stringify(eventData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Server response:', data);
                if (data.status === 'success') {
                    events.push(data.event);
                    initializeCalendar();
                    closeCreateEventModal();
                    document.getElementById('createEventForm').reset();
                }
            })
            .catch(error => {
                console.error('Error creating event:', error);
                alert('Failed to create event. Please try again.');
            });
        });

        function hasEventsOnDate(dateStr) {
            return events.some(event => event.date === dateStr);
        }

        function updateCalendarDots() {
            console.log('Updating calendar dots with events:', events);
            const days = document.querySelectorAll('.flatpickr-day');
            days.forEach(day => {
                const dateStr = flatpickr.formatDate(new Date(day.dateObj), "Y-m-d");
                console.log('Checking date:', dateStr);
                if (hasEventsOnDate(dateStr)) {
                    if (!day.querySelector('.event-dot')) {
                        day.innerHTML += '<span class="event-dot"></span>';
                    }
                }
            });
        }

        function showEventsForDate(dateStr) {
            const dateEvents = events.filter(event => event.date === dateStr);
            if (dateEvents && dateEvents.length > 0) {
                const eventsList = document.getElementById('eventsList');
                eventsList.innerHTML = dateEvents.map(event => `
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold">${event.title}</div>
                                <div class="text-sm text-gray-600">
                                    ${formatTime(event.time)} ${event.end_time ? ' - ' + formatTime(event.end_time) : ''}
                                </div>
                                ${event.end_date ? `
                                <div class="text-sm text-gray-600">
                                    Until ${formatDate(event.end_date)}
                                </div>
                                ` : ''}
                                <div class="text-sm mt-1">${event.description}</div>
                            </div>
                            <button onclick="deleteEvent(${event.id})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                document.getElementById('selectedDate').textContent = flatpickr.formatDate(new Date(dateStr), "F j, Y");
                document.getElementById('viewEventsModal').classList.remove('hidden');
            }
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function formatTime(timeStr) {
            if (!timeStr) return 'No time set';
            try {
                const [hours, minutes] = timeStr.split(':');
                const date = new Date();
                date.setHours(parseInt(hours), parseInt(minutes));
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } catch (e) {
                return timeStr;
            }
        }

        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                fetch(`/calendar/delete/${eventId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        events = events.filter(event => event.id !== eventId);
                        initializeCalendar();
                        const currentDate = flatpickr.formatDate(new Date(), "Y-m-d");
                        showEventsForDate(currentDate);
                        closeViewEventsModal();
                    }
                })
                .catch(error => console.error('Error deleting event:', error));
            }
        }
    </script>

    <script>
        // Image preview for create form
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('imagePreview');
            const container = document.getElementById('imagePreviewContainer');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    container.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                container.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.querySelector('input[type="file"]');
            if (fileInput) {
                fileInput.addEventListener('change', previewImage);
            }
        });
        
        // Resource modal functions
        function openResourceModal(resourceId) {
            currentResourceId = resourceId;
            const modal = document.getElementById('viewResourceModal');
            modal.classList.remove('hidden');
            
            fetch(`/resource/get/${resourceId}/`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('modalResourceTitle').textContent = data.title;
                    document.getElementById('modalResourceContent').innerHTML = data.description;
                    document.getElementById('modalAuthorName').textContent = data.author_name;
                    document.getElementById('modalDate').textContent = data.upload_date;
                    document.getElementById('modalHeartCount').textContent = `${data.download_count} downloads`;
                    document.getElementById('modalResourceCategory').textContent = data.category || 'Uncategorized';
                    
                    const imageContainer = document.getElementById('modalResourceImage');
                    if (data.image_url) {
                        imageContainer.innerHTML = `<img src="${data.image_url}" alt="${data.title}" class="w-full h-full object-cover">`;
                    } else {
                        imageContainer.innerHTML = '<div class="w-full h-full bg-gray-200 flex items-center justify-center"><span class="text-gray-500">No image available</span></div>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching resource details:', error);
                    closeResourceModal();
                });
        }
        
        function closeResourceModal() {
            const modal = document.getElementById('viewResourceModal');
            modal.classList.add('hidden');
        }
        
        document.getElementById('viewResourceModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeResourceModal();
    }
});
        // [Previous calendar and other JavaScript remains the same]
        </script>

        <script>
            function downloadResource(resourceId, event) {
                event.stopPropagation(); // Prevent modal from opening when clicking download
                
                fetch(`/resource/download/${resourceId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Update download count in the UI
                        document.querySelectorAll(`.download-count-${resourceId}`).forEach(el => {
                            el.textContent = data.download_count;
                        });
                        
                        // Update modal count if open
                        const modalCount = document.getElementById('modalHeartCount');
                        if (modalCount) {
                            modalCount.textContent = `${data.download_count} downloads`;
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        </script>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                tinymce.init({
                    selector: '.tinymce',
                    height: 300,
                    menubar: false,
                    plugins: 'lists link image table code',
                    toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist | link image',
                    content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; font-size: 14px }',
                    images_upload_url: '/resourcehub/upload/',  // Make sure this matches your URL configuration
                    images_upload_handler: function (blobInfo, success, failure) {
                        var xhr, formData;

                        xhr = new XMLHttpRequest();
                        xhr.withCredentials = false;
                        xhr.open('POST', '/resourcehub/upload/');

                        xhr.onload = function() {
                        var json;

                        if (xhr.status === 200) {
                            json = JSON.parse(xhr.responseText);
                            if (json.location) {
                            success(json.location);
                            } else {
                            failure('Invalid JSON: ' + xhr.responseText);
                            }
                        } else {
                            failure('HTTP Error: ' + xhr.status);
                        }
                        };

                        xhr.onerror = function() {
                        failure('Network Error');
                        };

                        formData = new FormData();
                        formData.append('file', blobInfo.blob(), blobInfo.filename());

                        xhr.send(formData);
                    },
                    });
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const categoryPills = document.querySelectorAll('.category-pill');
                const resourceCards = document.querySelectorAll('.resource-card');
            
                categoryPills.forEach(pill => {
                    pill.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Remove active state from all pills
                        categoryPills.forEach(p => {
                            p.classList.remove('bg-blue-500', 'text-white');
                            p.classList.add('bg-gray-100', 'text-gray-700');
                        });
            
                        // Add active state to clicked pill
                        this.classList.remove('bg-gray-100', 'text-gray-700');
                        this.classList.add('bg-blue-500', 'text-white');
            
                        // Get selected category
                        const selectedCategory = this.getAttribute('href').split('category=')[1] || 'all';
            
                        // Filter resources
                        resourceCards.forEach(card => {
                            const cardCategory = card.getAttribute('data-category');
                            
                            if (selectedCategory === 'all' || cardCategory === selectedCategory) {
                                card.style.display = 'block';
                            } else {
                                card.style.display = 'none';
                            }
                        });
                    });
                });
            });
        </script>

        <script>
            function updateNavUnreadCount() {
                fetch('/chat/unread-count/')
                    .then(response => response.json())
                    .then(data => {
                        const unreadBadge = document.getElementById('nav-unread-count');
                        if (unreadBadge) {  // Check if element exists
                            if (data.unread_count > 0) {
                                unreadBadge.textContent = data.unread_count;
                                unreadBadge.classList.remove('hidden');
                            } else {
                                unreadBadge.classList.add('hidden');
                            }
                        }
                    })
                    .catch(error => console.error('Error updating unread count:', error));
            }
        
            // Update unread count every 5 seconds
            function startUnreadCountPolling() {
                updateNavUnreadCount(); // Initial update
                setInterval(updateNavUnreadCount, 5000);
            }
        
            // Start polling when document is ready
            document.addEventListener('DOMContentLoaded', startUnreadCountPolling);
        </script>

</body>
</html>