{% extends 'users/base.html' %}
{% load static %}

{% block extra_css %}
    <link href="{% static 'users/css/profile.css' %}" rel="stylesheet">

    
    <style>
    :root {
        --primary-color: #3b82f6;
        --secondary-color: #10b981;
        --background-color: #f3f4f6;
        --text-color: #1f2937;
    }

    body {
        background-color: var(--background-color);
        font-family: 'Inter', sans-serif;
        line-height: 1.6;
        color: var(--text-color);
    }

    .profile-container {
        max-width: 600px;
        margin: 2rem auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    .profile-container:hover {
        transform: scale(1.02);
    }

    .profile-header {
        position: relative;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
    }

    .profile-avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    border: 5px solid white;
    object-fit: cover;
    position: absolute;
    bottom: -75px;
    left: 50%; 
    transform: translateX(-50%) scale(1);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    transition: 
        transform 0.3s ease-out, 
        box-shadow 0.3s ease-out;
    cursor: pointer;
}

.profile-avatar:hover {
    transform: translateX(-50%) scale(1.1); /* Slightly larger scale */
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
}

/* Optional: Add a subtle glow effect */
.profile-avatar:hover::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    background: radial-gradient(circle, rgba(59,130,246,0.2) 0%, rgba(16,185,134,0.1) 100%);
    border-radius: 50%;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease-out;
}

.profile-avatar:hover::before {
    opacity: 1;
}

    .header-buttons {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
    }

    .follow-button, .edit-button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 10px 15px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: background 0.3s ease;
    }

    .follow-button:hover, .edit-button:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .profile-info {
        margin-top: 100px;
        text-align: center;
        padding: 20px;
    }

    .profile-stats {
        display: flex;
        justify-content: space-around;
        background: #f9fafb;
        padding: 20px;
        text-align: center;
    }

    .stat-box {
        flex: 1;
        padding: 10px;
        border-radius: 10px;
        transition: background-color 0.3s ease;
    }

    .stat-box:hover {
        background-color: #e5e7eb;
    }

    .profile-details {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        border-bottom: 1px solid #e5e7eb;
    }

    .rating {
        color: #fbbf24;
        font-size: 1.2rem;
    }

    .action-buttons {
        display: flex;
        justify-content: space-around;
        padding: 20px;
    }

    .message-button, .report-button {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 20px;
        border-radius: 25px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .message-button:hover, .report-button:hover {
        background-color: #2563eb;
        transform: translateY(-3px);
    }

    /* Modal and Profile Picture Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .modal-content {
        background: white;
        border-radius: 15px;
        max-width: 500px;
        margin: 10% auto;
        padding: 30px;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .profile-picture-preview {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    margin: 0 auto 20px;
    overflow: hidden;
    position: relative;
    border: 4px solid #3b82f6;
    background-color: #f3f4f6;
}

.profile-picture-preview img {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 10;
}

.profile-picture-preview::before {
    content: 'Upload Photo';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    color: #6b7280;
    text-align: center;
    opacity: 0.7;
}

.profile-picture-preview:hover::after {
    content: 'Change Photo';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.5);
    color: white;
    text-align: center;
    padding: 10px;
    z-index: 20;
}
    .home-button {
        display: block;
        text-align: center;
        padding: 15px;
        background-color: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 0 0 16px 16px;
        transition: background-color 0.3s ease;
    }

    .home-button:hover {
        background-color: #2563eb;
    }
    .profile-bio {
    text-align: center;
    padding: 15px;
    margin: 10px 0;
    background-color: #f9fafb;
    border-radius: 8px;
    font-style: italic;
    color: #4b5563;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    transition: background-color 0.3s ease;
}

.profile-bio:hover {
    background-color: #f3f4f6;
}

.biography-text {
    line-height: 1.6;
    word-wrap: break-word;
    max-width: 100%;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-banner"></div>
        <img src="{{ user.profile_picture.url|default:'users/images/logo.png' }}" alt="Profile" class="profile-avatar">
        <div class="header-buttons">

            
            <button class="follow-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M19 8v6"></path>
                    <path d="M22 11h-6"></path>
                </svg>
                Follow
            </button>
            <button onclick="openEditModal()" class="edit-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit Profile
            </button>
        </div>
    </div>

    <div class="profile-info">
       
        
        <h2 class="profile-name">{{ user.firstname }} {{ user.lastname }}</h2>
        <span class="profile-occupation">{{ user.employmentStatus }}</span>

        <div class="profile-bio">
            <p class="biography-text">{{ user.biography|default:"Add a short biography to tell others about yourself" }}</p>
        </div>
    </div>

    <div class="profile-stats">
        <div class="stat-box">
            <h3>Languages</h3>
            <div class="language-tags">
                {% if user.languages %}
                    {% for language in user.languages.split %}
                        <span class="language-tag">{{ language }}</span>
                    {% endfor %}
                {% else %}
                    <p>No languages specified</p>
                {% endif %}
            </div>
        </div>
        <div class="stat-box">
            <h3>Activity Status</h3>
            <p class="activity-indicator {% if user.activity_status == 'Active' %}active{% elif user.activity_status == 'Moderate' %}moderate{% else %}inactive{% endif %}">
                <span class="status-dot"></span>
                {{ user.activity_status }}
            </p>
        </div>
    </div>
    
    <div class="profile-stats">
        <div class="stat-box">
            <h3>Hobbies</h3>
            <p>{{ user.hobbies|default:"Not specified" }}</p>
        </div>
        <div class="stat-box">
            <h3>Goals</h3>
            <p>{{ user.goals|default:"Community help<br>Seek friends"|safe }}</p>
        </div>
    </div>

    <div class="profile-details">
        <span>Age</span>
        <span>{{ user.age }}</span>
    </div>

    <div class="profile-details">
        <span>State</span>
        <span>{{ user.state }}</span>
    </div>

    <div class="profile-details">
        <span>Rating</span>
        <div class="rating">★★★★☆</div>
    </div>

    <div class="action-buttons">
        <button class="message-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
            </svg>
            Send Message
        </button>
        <button class="report-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12" y2="16"></line>
            </svg>
            Report
        </button>
    </div>

    <a href="{% url 'home' %}" class="home-button">HOME PAGE</a>

    <!-- Modal for editing profile -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 24px;">Edit Profile</h2>
            
            <form method="POST" enctype="multipart/form-data" action="{% url 'edit_profile' %}">
                {% csrf_token %}
                
                <div class="profile-picture-preview">
                    <img id="profilePicturePreview" src="{{ user.profile_picture.url|default:'users/images/logo.png' }}" alt="Profile Picture">
                    <input type="file" id="id_profile_picture" name="profile_picture" style="display: none;" accept="image/*">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_biography">Biography</label>
                    <textarea 
                        id="id_biography" 
                        name="biography" 
                        rows="4" 
                        class="form-control" 
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                        placeholder="Tell us a bit about yourself"
                    >{{ user.biography }}</textarea>
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_firstname">First Name</label>
                    <input type="text" id="id_firstname" name="firstname" value="{{ user.firstname }}" 
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_lastname">Last Name</label>
                    <input type="text" id="id_lastname" name="lastname" value="{{ user.lastname }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_age">Age</label>
                    <input type="number" id="id_age" name="age" value="{{ user.age }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_state">State</label>
                    <input type="text" id="id_state" name="state" value="{{ user.state }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_employmentStatus">Employment Status</label>
                    <input type="text" id="id_employmentStatus" name="employmentStatus" value="{{ user.employmentStatus }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_hobbies">Hobbies</label>
                    <input type="text" id="id_hobbies" name="hobbies" value="{{ user.hobbies }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                           placeholder="Enter your hobbies">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="id_goals">Goals</label>
                    <input type="text" id="id_goals" name="goals" value="{{ user.goals }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                           placeholder="Enter your goals">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_languages">Languages</label>
                    <input type="text" id="id_languages" name="languages" value="{{ user.languages }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                           placeholder="e.g., English, Spanish, Python, JavaScript">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="id_activity_status">Activity Status</label>
                    <select id="id_activity_status" name="activity_status" 
                            class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="Active" {% if user.activity_status == 'Active' %}selected{% endif %}>Very Active</option>
                        <option value="Moderate" {% if user.activity_status == 'Moderate' %}selected{% endif %}>Moderately Active</option>
                        <option value="Low" {% if user.activity_status == 'Low' %}selected{% endif %}>Less Active</option>
                        <option value="Inactive" {% if user.activity_status == 'Inactive' %}selected{% endif %}>Inactive</option>
                    </select>
                </div>

                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" onclick="closeEditModal()" 
                            style="padding: 8px 15px; margin-right: 10px; border-radius: 4px; background: #eee;">
                        Cancel
                    </button>
                    <button type="submit" 
                            style="padding: 8px 15px; border-radius: 4px; background: #4CAF50; color: white; border: none;">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function openEditModal() {
    document.getElementById('editProfileModal').style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editProfileModal').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', function() {
    const biographyTextarea = document.getElementById('id_biography');
    const maxLength = 250; // Adjust as needed

    biographyTextarea.addEventListener('input', function() {
        // Trim the content if it exceeds max length
        if (this.value.length > maxLength) {
            this.value = this.value.substr(0, maxLength);
        }

        // Optional: Show remaining characters
        const remainingChars = maxLength - this.value.length;
        const charCountSpan = document.getElementById('biography-char-count');
        if (charCountSpan) {
            charCountSpan.textContent = `${remainingChars} characters remaining`;
        }
    });
});

// Preview profile picture before upload
document.querySelector('.profile-picture-preview').addEventListener('click', function() {
    document.getElementById('id_profile_picture').click();
});

document.getElementById('id_profile_picture').addEventListener('change', function(e) {
    if (e.target.files && e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profilePicturePreview').src = e.target.result;
        }
        reader.readAsDataURL(e.target.files[0]);
    }
});

function validateForm() {
    const firstname = document.getElementById('id_firstname').value.trim();
    const lastname = document.getElementById('id_lastname').value.trim();
    const age = document.getElementById('id_age').value;
    const state = document.getElementById('id_state').value.trim();

    // Basic validation
    if (!firstname || !lastname || !age || !state) {
        alert('Please fill in all required fields');
        return false;
    }

    if (age < 18 || age > 120) {
        alert('Please enter a valid age');
        return false;
    }

    return true;
}

document.querySelector('form').addEventListener('submit', function(e) {
    if (!validateForm()) {
        e.preventDefault();
    }
});





// Close modal when clicking outside
window.onclick = function(event) {
    if (event.target == document.getElementById('editProfileModal')) {
        closeEditModal();
    }
}
</script>
{% endblock %}