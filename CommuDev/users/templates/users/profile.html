{% extends 'users/base.html' %}
{% load static %}

{% block extra_css %}
    <link href="{% static 'users/css/profile.css' %}" rel="stylesheet">
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .profile-picture-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            border: 3px solid #e2e8f0;
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-preview:hover::after {
            content: 'Change Photo';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            text-align: center;
            font-size: 14px;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            cursor: pointer;
            font-size: 24px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-banner"></div>
        <img src="{{ user.profile_picture.url|default:'users/images/logo.png' }}" alt="Profile" class="profile-avatar">
        <div class="header-buttons">

            
            <button class="follow-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M19 8v6"></path>
                    <path d="M22 11h-6"></path>
                </svg>
                Follow
            </button>
            <button onclick="openEditModal()" class="edit-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit Profile
            </button>
        </div>
    </div>

    <div class="profile-info">
        <h2 class="profile-name">{{ user.firstname }} {{ user.lastname }}</h2>
        <span class="profile-occupation">{{ user.employmentStatus }}</span>
    </div>

    <div class="profile-stats">
        <div class="stat-box">
            <h3>Reward Pts</h3>
            <p>{{ user.points|default:"0" }} Reward Pts</p>
        </div>
        <div class="stat-box">
            <h3>Followers</h3>
            <p>52 Followers</p>
        </div>
    </div>

    <div class="profile-stats">
        <div class="stat-box">
            <h3>Hobbies</h3>
            <p>{{ user.hobbies|default:"Not specified" }}</p>
        </div>
        <div class="stat-box">
            <h3>Goals</h3>
            <p>Community help<br>Seek friends</p>
        </div>
    </div>

    <div class="profile-details">
        <span>Age</span>
        <span>{{ user.age }}</span>
    </div>

    <div class="profile-details">
        <span>State</span>
        <span>{{ user.state }}</span>
    </div>

    <div class="profile-details">
        <span>Rating</span>
        <div class="rating">★★★★☆</div>
    </div>

    <div class="action-buttons">
        <button class="message-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
            </svg>
            Send Message
        </button>
        <button class="report-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12" y2="16"></line>
            </svg>
            Report
        </button>
    </div>

    <a href="{% url 'home' %}" class="home-button">HOME PAGE</a>

    <!-- Modal for editing profile -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 24px;">Edit Profile</h2>
            
            <form method="POST" enctype="multipart/form-data" action="{% url 'edit_profile' %}">
                {% csrf_token %}
                
                <div class="profile-picture-preview">
                    <img id="profilePicturePreview" src="{{ user.profile_picture.url|default:'users/images/logo.png' }}" alt="Profile Picture">
                    <input type="file" id="id_profile_picture" name="profile_picture" style="display: none;" accept="image/*">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_firstname">First Name</label>
                    <input type="text" id="id_firstname" name="firstname" value="{{ user.firstname }}" 
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_lastname">Last Name</label>
                    <input type="text" id="id_lastname" name="lastname" value="{{ user.lastname }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_age">Age</label>
                    <input type="number" id="id_age" name="age" value="{{ user.age }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_state">State</label>
                    <input type="text" id="id_state" name="state" value="{{ user.state }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="id_employmentStatus">Employment Status</label>
                    <input type="text" id="id_employmentStatus" name="employmentStatus" value="{{ user.employmentStatus }}"
                           class="form-control" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" onclick="closeEditModal()" 
                            style="padding: 8px 15px; margin-right: 10px; border-radius: 4px; background: #eee;">
                        Cancel
                    </button>
                    <button type="submit" 
                            style="padding: 8px 15px; border-radius: 4px; background: #4CAF50; color: white; border: none;">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function openEditModal() {
    document.getElementById('editProfileModal').style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editProfileModal').style.display = 'none';
}

// Preview profile picture before upload
document.querySelector('.profile-picture-preview').addEventListener('click', function() {
    document.getElementById('id_profile_picture').click();
});

document.getElementById('id_profile_picture').addEventListener('change', function(e) {
    if (e.target.files && e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profilePicturePreview').src = e.target.result;
        }
        reader.readAsDataURL(e.target.files[0]);
    }
});

// Close modal when clicking outside
window.onclick = function(event) {
    if (event.target == document.getElementById('editProfileModal')) {
        closeEditModal();
    }
}
</script>
{% endblock %}